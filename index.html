<!DOCTYPE html>
<!-- saved from url=(0068)file:///C:/Users/jgamon/Downloads/calculadora_de_boletos%20F0.2.html -->
<html lang="es"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Calculadora de Boletos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f4f1;
      color: #333;
      padding: 20px;
      padding-bottom: 240px;
    }
    h1 {
      color: #800000;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f0e6e6;
    }
    button {
      margin: 5px;
      padding: 8px 16px;
      background-color: #800000;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #a00000;
    }
    .resumen-fija {
  position: static;
  margin-top: 30px;
  width: 100%;
  background-color: #f0e6e6;
  display: flex;
  justify-content: space-around;
  padding: 20px;
  border-top: 2px solid #800000;
  box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
}
    .columna {
      flex: 1;
      max-width: 400px;
      padding: 10px;
    }
    .columna h3 {
      color: #800000;
      margin-top: 0;
    }
    .botones-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 7px;
      margin-top: 15px;
    }
	tr.activa {
  background-color: #ffe0e0 !important;
  border: 2px solid #800000;
}

.resumen-fija.minimizada {
  height: 30px;
  overflow: hidden;
  padding: 5px 20px;
}
  </style>
</head>
<body>
  <h1>Calculadora de Boletos</h1>
  <label>Nombre del Evento:
    <input type="text" id="nombreEvento" placeholder="Ej. Festival Cultural">
  </label>

  <table id="tablaBoletos">
    <thead>
      <tr>
        <th>#</th>
        <th>Cantidad</th>
        <th>Localidad</th>
        <th>Precio Unitario</th>
        <th>Total (MXN)</th>
      </tr>
    </thead>
    <tbody id="cuerpoTabla">
      
    <tr class="">
        <td>1</td>
        <td><input type="number" value="0" onchange="actualizarTotales()"></td>
        <td><input type="text" onchange="actualizarTotales()"></td>
        <td><input type="number" value="0" onchange="actualizarTotales()"></td>
        <td class="totalFila">$0.00</td>
      </tr></tbody>
    <tbody><tr id="filaTotales">
      <td colspan="2"><strong>Total de boletos:</strong> <span id="totalBoletos">0</span></td>
      <td colspan="2"><strong>Promedio Precio Unitario:</strong> <span id="promedioPrecioUnitario">$0.00</span></td>
      <td><strong>Suma Total:</strong> <span id="sumaTotalBoletos">$0.00</span></td>
    </tr>
  </tbody></table>

  <div class="botones-grid">
    <button onclick="agregarFila()">Agregar Fila</button>
    <button onclick="eliminarFilaSeleccionada()">Eliminar Fila Activa</button>
    <button onclick="agregarColumnaCantidad()">Agregar Otra Columna de Cantidad</button>
    <button onclick="eliminarColumnasCantidadExtra()">Eliminar Columnas de Cantidad Extra</button>
    <button onclick="ordenarPorPrecio()">Ordenar por Precio Unitario (Mayor a Menor)</button>
    	<div >
	</div>
	
	

	
	<button onclick="guardarDatos()">Guardar datos en archivo TXT</button>
	<button onclick="document.getElementById(&#39;archivoInput&#39;).click()">Cargar datos desde archivo TXT</button>
    <input type="file" id="archivoInput" accept=".txt" style="display:none" onchange="cargarArchivo()">
  </div>

  <div class="resumen-fija">
    <div class="columna">
      <h3>M U N I C I P I O</h3>
Interventores: <input type="number" id="interventores1" value="1" onchange="actualizarTotales()"><br>
Honorarios: <input type="number" id="honorarios1" value="1248" onchange="actualizarTotales()"><br>
Impuesto (%): <input type="number" id="impuesto1" value="6" onchange="actualizarTotales()"><br>
Porcentaje a cobrar (%): <input type="number" id="porcentajeIngreso1" value="100" onchange="actualizarTotales()"><br>
<p id="montoPorcentaje1">Sobre ingreso: $0.00</p>

<p id="montoImpuesto1">Impuesto: $0.00</p>
<p id="honorariosTotales1">Honorarios Totales: $1,248.00</p>
<p id="totalCobrar1">Total a Cobrar: $1,248.00</p>
    </div>
    <div class="columna">
      <h3>E S T A D O</h3>
Interventores: <input type="number" id="interventores2" value="1" onchange="actualizarTotales()"><br>
Honorarios: <input type="number" id="honorarios2" value="1500" onchange="actualizarTotales()"><br>
Impuesto (%): <input type="number" id="impuesto2" value="5" onchange="actualizarTotales()"><br>
Porcentaje a cobrar (%): <input type="number" id="porcentajeIngreso2" value="100" onchange="actualizarTotales()"><br>
<p id="montoPorcentaje2">Sobre ingreso: $0.00</p>

<p id="montoImpuesto2">Impuesto: $0.00</p>
<p id="honorariosTotales2">Honorarios Totales: $1,500.00</p>
<p id="totalCobrar2">Total a Cobrar: $1,500.00</p>

    </div>
  </div>

<script>

function activarFilaDesdeInput(input) {
  const fila = input.closest("tr");
  if (!fila) return;
  document.querySelectorAll("#cuerpoTabla tr").forEach(f => f.classList.remove("activa"));
  fila.classList.add("activa");
}

function actualizarTotales() {
  const filas = document.querySelectorAll("#cuerpoTabla tr");
  const headers = document.querySelectorAll("#tablaBoletos thead th");
  let totalGeneral = 0;
  let sumaPrecios = 0;
  let totalBoletos = 0;

  filas.forEach(fila => {
    const celdas = fila.querySelectorAll("td");
    let cantidad = 0;

    celdas.forEach((celda, idx) => {
      const header = headers[idx]?.textContent.trim();
      const input = celda.querySelector("input");

      if ((header === "Cantidad" || header === "Cantidad Extra") && input) {
        const valor = parseFloat(input.value);
        if (!isNaN(valor)) {
          cantidad += valor;
        }
      }
    });

    const precio = parseFloat(celdas[celdas.length - 2].querySelector("input")?.value || 0);
    const total = cantidad * precio;

    celdas[celdas.length - 1].textContent = formatearMoneda(total);
    totalGeneral += total;
    sumaPrecios += precio;
    totalBoletos += cantidad;
  });

  document.getElementById("totalBoletos").textContent = totalBoletos;
  document.getElementById("promedioPrecioUnitario").textContent = formatearMoneda(sumaPrecios / filas.length);
  document.getElementById("sumaTotalBoletos").textContent = formatearMoneda(totalGeneral);

  [1, 2].forEach(num => {
  const interventores = parseFloat(document.getElementById(`interventores${num}`).value) || 0;
  const honorarios = parseFloat(document.getElementById(`honorarios${num}`).value) || 0;
  const impuesto = parseFloat(document.getElementById(`impuesto${num}`).value) || 0;
  const porcentajeIngreso = parseFloat(document.getElementById(`porcentajeIngreso${num}`).value) || 0;

  const honorariosTotales = interventores * honorarios;
  const montoImpuesto = totalGeneral * (impuesto / 100);
  const montoSobreIngreso = totalGeneral * (porcentajeIngreso / 100);
  const totalCobrar = honorariosTotales + montoImpuesto;


  document.getElementById(`honorariosTotales${num}`).textContent = `Honorarios Totales: ${formatearMoneda(honorariosTotales)}`;
  document.getElementById(`montoImpuesto${num}`).textContent = `Impuesto: ${formatearMoneda(montoImpuesto)}`;
  document.getElementById(`montoPorcentaje${num}`).textContent = `Sobre ingreso: ${formatearMoneda(montoSobreIngreso)}`;
  document.getElementById(`totalCobrar${num}`).textContent = `Total a Cobrar: ${formatearMoneda(totalCobrar)}`;
});


  const total1 = parseFloat(document.getElementById("totalCobrar1").textContent.replace(/[^\d.-]/g, "")) || 0;
const total2 = parseFloat(document.getElementById("totalCobrar2").textContent.replace(/[^\d.-]/g, "")) || 0;
document.getElementById("totalCobrarGlobal").textContent = formatearMoneda(total1 + total2);
}

function agregarFila() {
  const cuerpo = document.getElementById("cuerpoTabla");
  const nuevaFila = cuerpo.rows[0].cloneNode(true);

  nuevaFila.querySelectorAll("input").forEach(input => {
    input.value = "0";
    input.addEventListener("input", actualizarTotales);
  });

  nuevaFila.querySelector(".totalFila").textContent = "$0.00";
  nuevaFila.cells[0].textContent = cuerpo.rows.length + 1;

  // Marcar como fila activa y quitar activo de las otras
  document.querySelectorAll("#cuerpoTabla tr").forEach(f => f.classList.remove("activa"));
  nuevaFila.classList.add("activa");

  // Activar selecciÃ³n al hacer clic en la nueva fila
  nuevaFila.onclick = function () {
    document.querySelectorAll("#cuerpoTabla tr").forEach(f => f.classList.remove("activa"));
    this.classList.add("activa");
  };

  cuerpo.appendChild(nuevaFila);
  actualizarTotales();

  // Colocar cursor en campo "Cantidad" y seleccionar valor
  const inputCantidad = nuevaFila.cells[1].querySelector("input");
  if (inputCantidad) {
    inputCantidad.focus();
    inputCantidad.select();
  }
}

function eliminarFilaSeleccionada() {
  const filaActiva = document.querySelector("#cuerpoTabla tr.activa");
  if (!filaActiva) {
    alert("Selecciona una fila primero haciendo clic sobre ella.");
    return;
  }
  filaActiva.remove();
  const filas = document.querySelectorAll("#cuerpoTabla tr");
  filas.forEach((fila, index) => {
    fila.cells[0].textContent = index + 1;
  });
  actualizarTotales();
}

function agregarColumnaCantidad() {
  const tabla = document.getElementById("tablaBoletos");
  const encabezado = tabla.querySelector("thead tr");
  const filas = tabla.querySelectorAll("tbody tr");

  const nuevaCol = document.createElement("th");
  nuevaCol.textContent = "Cantidad Extra";
  encabezado.insertBefore(nuevaCol, encabezado.children[2]);

  filas.forEach(fila => {
    const celda = document.createElement("td");
    const input = document.createElement("input");
    input.type = "number";
    input.value = 0;
    input.onchange = actualizarTotales;
    celda.appendChild(input);
    fila.insertBefore(celda, fila.children[2]);
  });
}

function eliminarColumnasCantidadExtra() {
  const tabla = document.getElementById("tablaBoletos");
  const encabezado = tabla.querySelector("thead tr");
  const filas = tabla.querySelectorAll("tbody tr");

  const indices = [];
  encabezado.querySelectorAll("th").forEach((th, index) => {
    if (th.textContent === "Cantidad Extra") {
      indices.push(index);
    }
  });

  indices.reverse().forEach(index => {
    encabezado.deleteCell(index);
    filas.forEach(fila => {
      const valor = parseFloat(fila.cells[index].querySelector("input")?.value || 0);
      const celdaBase = fila.cells[1].querySelector("input");
      if (celdaBase) celdaBase.value = parseFloat(celdaBase.value || 0) + valor;
      fila.deleteCell(index);
    });
  });

  actualizarTotales();
}

function ordenarPorPrecio() {
  const cuerpo = document.getElementById("cuerpoTabla");
  const filas = Array.from(cuerpo.querySelectorAll("tr"));

  const filasOrdenadas = filas.sort((a, b) => {
    const precioA = parseFloat(a.cells[a.cells.length - 2].querySelector("input").value) || 0;
    const precioB = parseFloat(b.cells[b.cells.length - 2].querySelector("input").value) || 0;
    return precioB - precioA;
  });

  cuerpo.innerHTML = "";
  filasOrdenadas.forEach((fila, index) => {
    fila.cells[0].textContent = index + 1;
    cuerpo.appendChild(fila);
  });

  actualizarTotales();
}

function guardarDatos() {
  let contenido = "Nombre del Evento: " + document.getElementById("nombreEvento").value + "\n\n";

  // Guardar filas de boletos
  const filas = document.querySelectorAll("#cuerpoTabla tr");
  filas.forEach((fila, i) => {
    const celdas = fila.querySelectorAll("td");
    const cantidad = celdas[1].querySelector("input").value;
    const localidad = celdas[2].querySelector("input").value;
    const precio = celdas[3].querySelector("input").value;
    contenido += `Fila ${i + 1}: Cantidad=${cantidad}, Localidad="${localidad}", Precio=${precio}\n`;
  });

  // Guardar columnas de resumen
  for (let num = 1; num <= 2; num++) {
    contenido += `\nColumna ${num}:\n`;
    contenido += `Interventores=${document.getElementById(`interventores${num}`).value}\n`;
    contenido += `Honorarios=${document.getElementById(`honorarios${num}`).value}\n`;
    contenido += `Impuesto=${document.getElementById(`impuesto${num}`).value}%\n`;
    contenido += `PorcentajeIngreso=${document.getElementById(`porcentajeIngreso${num}`).value}%\n`;
  }

  // Descargar como archivo .txt
  const blob = new Blob([contenido], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = (document.getElementById("nombreEvento").value || "boletos") + ".txt";
  a.click();
  URL.revokeObjectURL(url);
}


function guardarDatos() {
  let contenido = "Nombre del Evento: " + document.getElementById("nombreEvento").value + "\n\n";

  // Guardar filas de boletos
  const filas = document.querySelectorAll("#cuerpoTabla tr");
  filas.forEach((fila, i) => {
    const celdas = fila.querySelectorAll("td");
    const cantidad = celdas[1].querySelector("input").value;
    const localidad = celdas[2].querySelector("input").value;
    const precio = celdas[3].querySelector("input").value;
    contenido += `Fila ${i + 1}: Cantidad=${cantidad}, Localidad="${localidad}", Precio=${precio}\n`;
  });

  // Guardar columnas de resumen
  for (let num = 1; num <= 2; num++) {
    contenido += `\nColumna ${num}:\n`;
    contenido += `Interventores=${document.getElementById(`interventores${num}`).value}\n`;
    contenido += `Honorarios=${document.getElementById(`honorarios${num}`).value}\n`;
    contenido += `Impuesto=${document.getElementById(`impuesto${num}`).value}%\n`;
    contenido += `PorcentajeIngreso=${document.getElementById(`porcentajeIngreso${num}`).value}%\n`;
  }

  // Descargar como archivo .txt
  const blob = new Blob([contenido], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = (document.getElementById("nombreEvento").value || "boletos") + ".txt";
  a.click();
  URL.revokeObjectURL(url);
}

function formatearMoneda(valor) {
  return "$" + valor.toLocaleString("es-MX", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
function formatearMoneda(valor) {
  return "$" + valor.toLocaleString("es-MX", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
// Habilita selecciÃ³n de fila activa para las filas ya cargadas
document.querySelectorAll("#cuerpoTabla tr").forEach(fila => {
  fila.onclick = function () {
    document.querySelectorAll("#cuerpoTabla tr").forEach(f => f.classList.remove("activa"));
    this.classList.add("activa");
  };
});
document.querySelectorAll("#cuerpoTabla tr input").forEach(input => {
  input.addEventListener("focus", () => activarFilaDesdeInput(input));
});
function activarEventosFocusInputs() {
  document.querySelectorAll("#cuerpoTabla tr input").forEach(input => {
    input.addEventListener("focus", () => activarFilaDesdeInput(input));
  });
}
document.addEventListener("DOMContentLoaded", () => {
  function activarFilaPorHover(fila) {
    document.querySelectorAll("#cuerpoTabla tr").forEach(f => f.classList.remove("activa"));
    fila.classList.add("activa");
  }

  
  activarEventosHover();
  activarEventosFocusInputs(); // â Este es el que activa el enfoque por teclado

  // Reaplicar eventos cuando agregas nuevas filas
  const originalAgregarFila = agregarFila;
  agregarFila = function () {
    originalAgregarFila();
    activarEventosHover();
    activarEventosFocusInputs(); // â TambiÃ©n lo aplicas a los nuevos inputs
  };
});
// Asegura que cada vez que un input obtiene foco por tabulaciÃ³n, se marque su fila como activa
document.addEventListener("keydown", function (e) {
  if (e.key === "Tab") {
    setTimeout(() => {
      const activeInput = document.activeElement;
      if (activeInput && activeInput.tagName === "INPUT") {
        activarFilaDesdeInput(activeInput);
      }
    }, 10); // pequeÃ±o retardo para esperar el nuevo foco
  }
});
document.getElementById("toggleResumen").addEventListener("click", function () {
  const resumen = document.querySelector(".resumen-fija");
  resumen.classList.toggle("minimizada");
  this.textContent = resumen.classList.contains("minimizada") ? "Maximizar" : "Minimizar";
});
 const btnToggle = document.getElementById("toggleResumen");
  const resumen = document.querySelector(".resumen-fija");

  btnToggle.addEventListener("click", () => {
    if (resumen.style.display === "none") {
      resumen.style.display = "flex";
      btnToggle.textContent = "Ocultar resumen";
    } else {
      resumen.style.display = "none";
      btnToggle.textContent = "Mostrar resumen";
    }
  });



function cargarArchivo() {
  const input = document.getElementById("archivoInput");
  if (!input.files.length) return;

  const archivo = input.files[0];
  const lector = new FileReader();

  lector.onload = function (e) {
    const contenido = e.target.result;
    const lineas = contenido.split(/\r?\n/);

    // Limpiar tabla antes de cargar
    const cuerpo = document.getElementById("cuerpoTabla");
    cuerpo.innerHTML = "";
    let filaNum = 1;

    lineas.forEach((linea, index) => {
      if (linea.startsWith("Nombre del Evento:")) {
        document.getElementById("nombreEvento").value = linea.split(":")[1].trim();
      }

      if (linea.startsWith("Fila ")) {
        const match = linea.match(/Cantidad=(\d+), Localidad="(.*?)", Precio=(\d+)/);
        if (match) {
          const nuevaFila = document.createElement("tr");
          nuevaFila.classList.remove("activa");
          nuevaFila.innerHTML = `
            <td>${filaNum++}</td>
            <td><input type="number" value="${match[1]}" onchange="actualizarTotales()"></td>
            <td><input type="text" value="${match[2]}" onchange="actualizarTotales()"></td>
            <td><input type="number" value="${match[3]}" onchange="actualizarTotales()"></td>
            <td class="totalFila">$0.00</td>
          `;
          nuevaFila.onclick = function () {
            document.querySelectorAll("#cuerpoTabla tr").forEach(f => f.classList.remove("activa"));
            this.classList.add("activa");
          };
          cuerpo.appendChild(nuevaFila);
        }
      }

      if (linea.startsWith("Columna ")) {
        const columna = linea.includes("2") ? 2 : 1;
        for (let i = 1; i <= 4; i++) {
          const valor = lineas[index + i].split("=")[1].replace("%", "").trim();
          if (lineas[index + i].startsWith("Interventores=")) {
            document.getElementById(`interventores${columna}`).value = valor;
          } else if (lineas[index + i].startsWith("Honorarios=")) {
            document.getElementById(`honorarios${columna}`).value = valor;
          } else if (lineas[index + i].startsWith("Impuesto=")) {
            document.getElementById(`impuesto${columna}`).value = valor;
          } else if (lineas[index + i].startsWith("PorcentajeIngreso=")) {
            document.getElementById(`porcentajeIngreso${columna}`).value = valor;
          }
        }
      }
    });

    activarEventosFocusInputs(); // activar comportamiento de selecciÃ³n
    actualizarTotales();
  };

  lector.readAsText(archivo);
}






</script>
<div style="margin-top: 20px; padding: 15px; background-color: #f0e6e6; border: 2px solid #800000;">
  <h3 style="margin: 0; color: #800000;">Total Global a Cobrar: <span id="totalCobrarGlobal">$0.00</span></h3>
</div>
</body></html>
